import{f as j,r as u,j as W,X as s,b as A,w as I,h as p,aF as X,ad as q,ae as M,ak as o,b5 as n,a0 as G,c as h,a1 as J,bo as Q}from"./@vue.3182ba0d.js";import{u as Y}from"./vuex.fa60dc2b.js";import{b as Z}from"./vue-router.9966525b.js";import{i as R}from"./resize.b816c2d2.js";import{g as ee,u as te,d as ae,a as se,b as ue}from"./tags.96b0ec0b.js";import{_ as le}from"./index.e829efe3.js";import{w as oe,u as re,x as N,t as c,y as ie,A as ne,B as ce}from"./naive-ui.50411a32.js";import"./index.3fa5d1e3.js";import"./axios.0309b134.js";import"./xiao-you-bus.01e4f99d.js";import"./aplayer.feb7d914.js";import"./plyr.e249d6ea.js";import"./vueuc.f520d797.js";import"./evtd.5b1ed12a.js";import"./seemly.bd85dbed.js";import"./@css-render.4d849085.js";import"./vooks.54ac2ec9.js";import"./vdirs.03f40802.js";import"./resize-observer-polyfill.8deb1e21.js";import"./css-render.d5050412.js";import"./@emotion.6322e2ae.js";import"./lodash-es.48bbfd83.js";import"./date-fns.ecfd739c.js";import"./treemate.6d922cc8.js";const de={style:{"margin-bottom":"20px"}},pe=h("+ New"),me=h("DeleteAll"),ge={class:"modalAction"},ve=h("Cancel"),fe=j({setup(ye){const S=Z(),K={pageSize:12},U=Y(),B=oe(),l=re(),E=u([]),C=u([]),k=u(null),D=u("");W(()=>{L(),setTimeout(()=>{m(),F.value=!1},1e3)});const L=()=>{D.value=k.value.offsetHeight-170+""},m=async()=>{r.value.length=0;const e=await ee();e.state&&(e.data.reverse(),e.data.forEach(t=>{r.value.push({Id:t.tag_id,Name:t.tag_name,Date:new Date(parseInt(t.tag_addTime)).toLocaleString(),ArticlesTotal:t.hasArticleCount,isEdit:!1})}),g=s(r))},z=A(()=>C.value.reduce((e,{columnKey:t,order:a})=>(e[t]=a,e),{})),H=e=>{E.value=e},r=u([]);let g;const F=u(!0),v=u(!1),i=u(""),d=u("undefined"),y=u(!1),f=u(!1),P=()=>{v.value=!0,d.value="success"};I(i,e=>{e.trim()===""?d.value="error":d.value="success"});const b=async()=>{if(i.value.trim()==""){d.value="error",l.warning("\u8BF7\u8F93\u5165\u6807\u7B7E\u540D\u79F0!");return}if(g&&g.some(a=>a.Name==i.value)&&g!=null){l.warning("\u6807\u7B7E\u540D\u79F0\u91CD\u590D!");return}y.value=!0,f.value=!0,d.value="success",(await se({tagName:i.value,tagAddTime:new Date().getTime()+""})).state?setTimeout(()=>{i.value="",v.value=!1,y.value=!1,f.value=!1,m(),l.success("\u65B0\u589E\u6807\u7B7E\u6210\u529F")},1e3):(y.value=!1,f.value=!1,l.error("\u65B0\u589E\u6807\u7B7E\u5931\u8D25"))},_=u(null);I(_,e=>{e==""&&(r.value=g),r.value=s(r).filter(t=>t.Name.toLocaleLowerCase().includes(e.trim().toLowerCase()))});const V=A(()=>[{type:"selection"},{title:"Id",key:"Id",align:"center"},{title:"Name",key:"Name",align:"center",ellipsis:{tooltip:!0},render(e,t){return e.isEdit?p(N,{value:e.Name,onUpdateValue(a){r.value[t].Name=a},async onKeyup(a){if(a.code=="Enter"){const{Id:x,Name:T}=s(e),w=await te({newTagName:T,tagId:x});e.isEdit=!1,w.state?(l.success("\u4FEE\u6539\u6807\u7B7E\u540D\u79F0\u6210\u529F"),m()):l.error("\u4FEE\u6539\u6807\u7B7E\u540D\u79F0\u5931\u8D25")}}}):p("div",e.Name)}},{title:"Date",key:"Date",align:"center",ellipsis:{tooltip:!0}},{title:"ArticlesTotal",key:"ArticlesTotal",align:"center",sortOrder:z.value.ArticlesTotal||!1,sorter(e,t){return e.ArticlesTotal-t.ArticlesTotal}},{title:"Action",key:"Action",align:"center",render(e,t){const a=()=>{e.isEdit=!e.isEdit},x=()=>{B.error({title:"\u662F\u5426\u5220\u9664\u6807\u7B7E",positiveText:"\u662F",negativeText:"\u7B97\u4E86",onPositiveClick:async()=>{(await ue({id:e.Id})).state?(l.success("\u6807\u7B7E\u5220\u9664\u6210\u529F"),m()):l.error("\u6807\u7B7E\u5220\u9664\u5931\u8D25")},onNegativeClick:()=>{}})},T=()=>{S.push({name:"detail",params:{id:e.Id,type:"tag"}})};return p("div",{class:"action"},{default(){return[p(c,{onClick:a,type:"primary",style:`margin-right:20px;margin-bottom:${R.value?"0":"10px"}`},{default(){return e.isEdit?"Cancel":"Edit"}}),p(c,{onClick:T,type:"info",style:`margin-right:20px;margin-bottom:${R.value?"0":"10px"}`},{default(){return"Detail"}}),p(c,{onClick:x,type:"error"},{default(){return"Delete"}})]}})}}]),$=e=>{C.value=[].concat(e)},O=()=>{if(E.value.length==0){l.warning("\u8BF7\u52FE\u9009\u81F3\u5C11\u4E00\u4E2A\u8981\u5220\u9664\u7684\u6807\u7B7E");return}B.error({title:"\u662F\u5426\u5220\u9664\u52FE\u9009\u7684\u6807\u7B7E",positiveText:"\u662F",negativeText:"\u7B97\u4E86",onPositiveClick:async()=>{(await ae({tagIds:E.value})).state?(l.success("\u6807\u7B7E\u6279\u91CF\u5220\u9664\u6210\u529F"),m()):l.error("\u6807\u7B7E\u6279\u91CF\u5220\u9664\u5931\u8D25")},onNegativeClick:()=>{}})};return(e,t)=>(X(),q("div",{class:"tagBox",ref_key:"tagBox",ref:k,style:G({background:s(U).state.theme=="light"?"#fff":"#333"})},[M("div",de,[o(s(c),{type:"primary",style:{"margin-right":"30px"},onClick:P},{default:n(()=>[pe]),_:1}),o(s(c),{type:"error",style:{"margin-right":"30px"},onClick:O},{default:n(()=>[me]),_:1}),o(s(N),{value:_.value,"onUpdate:value":t[0]||(t[0]=a=>_.value=a),type:"text",placeholder:"Search About Name",clearable:"",style:{width:"200px"}},null,8,["value"])]),o(s(ie),{columns:s(V),data:r.value,pagination:K,"row-key":a=>a.Id,"onUpdate:checkedRowKeys":H,"onUpdate:sorter":$,striped:"","max-height":D.value,loading:F.value},null,8,["columns","data","row-key","max-height","loading"]),o(s(ne),{show:v.value,"onUpdate:show":t[3]||(t[3]=a=>v.value=a)},{default:n(()=>[o(s(ce),{style:{width:"600px"},title:"+ New Tag",bordered:!1,size:"huge",role:"dialog","aria-modal":"true"},{footer:n(()=>[M("div",ge,[o(s(c),{type:"error",onClick:t[2]||(t[2]=a=>v.value=!1)},{default:n(()=>[ve]),_:1}),o(s(c),{type:"success",onClick:b,loading:y.value,disabled:f.value},{default:n(()=>[h(J(f.value?"":"Create"),1)]),_:1},8,["loading","disabled"])])]),default:n(()=>[o(s(N),{value:i.value,"onUpdate:value":t[1]||(t[1]=a=>i.value=a),type:"text",placeholder:"Write Tag Name",clearable:"",status:d.value,onKeyup:Q(b,["enter"])},null,8,["value","status","onKeyup"])]),_:1})]),_:1},8,["show"])],4))}});var Ve=le(fe,[["__scopeId","data-v-53351ed6"]]);export{Ve as default};
